#!/usr/bin/env bash

docker-compose stop db && \
docker-compose rm --force db && \
docker-compose up -d db

n=0

until [ $n -ge 5 ]
do
  sleep 10
  docker-compose exec web sh -c "bin/console doctrine:migrations:migrate -n && bin/console doctrine:fixtures:load -n --append --multiple-transactions" && break
  n=$[$n+1]
done
